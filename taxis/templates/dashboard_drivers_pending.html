{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/theme.css' %}">
<style>
body {
    background-color:#0f0f0f;
    background-image:
        linear-gradient(rgba(26,26,26,.95), rgba(26,26,26,.95)),
        url('{% static "imagenes/DE_AQU_PALL_Logo.jpg" %}');
    background-size:600px;
    background-position:center;
    background-repeat:no-repeat;
    background-attachment:fixed;
    min-height:100vh;
    color:white;
}
.table-card{
    background:#1f1f1f;
    border-radius:20px;
    padding:2rem;
}
.modal-content{
    background:#1f1f1f;
    color:white;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">

<h2 class="text-warning mb-4">Aprobación de Conductores</h2>

<div class="table-card">
<table class="table table-dark table-hover">
<thead>
<tr>
    <th>Conductor</th>
    <th>Email</th>
    <th>Documento</th>
    <th>Estado</th>
    <th>Fecha</th>
    <th>Acciones</th>
</tr>
</thead>

<tbody>
{% for driver in drivers %}
<tr>
<td>{{ driver.get_full_name }}</td>
<td>{{ driver.email }}</td>
<td>{{ driver.national_id|default:"-" }}</td>
<td>
{% if driver.driver_status == "pending" %}
<span class="badge bg-warning">Pendiente</span>
{% elif driver.driver_status == "approved" %}
<span class="badge bg-success">Aprobado</span>
{% elif driver.driver_status == "rejected" %}
<span class="badge bg-danger">Rechazado</span>
{% endif %}
</td>
<td>{{ driver.date_joined|date:"d/m/Y H:i" }}</td>

<td>
{% if driver.driver_status == "pending" %}
<button class="btn btn-success btn-sm"
 data-bs-toggle="modal"
 data-bs-target="#approveModal{{ driver.pk }}">
✔
</button>

<button class="btn btn-danger btn-sm"
 data-bs-toggle="modal"
 data-bs-target="#rejectModal{{ driver.pk }}">
✖
</button>
{% endif %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>


<!-- MODALES FUERA DE LA TABLA -->
{% for driver in drivers %}

<!-- APROBAR -->
<div class="modal fade" id="approveModal{{ driver.pk }}" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header bg-success">
        <h5 class="modal-title">Aprobar {{ driver.get_full_name }}</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="post" action="{% url 'dashboard_driver_approve' driver.pk %}">
        {% csrf_token %}
        <div class="modal-body">
          <label>Número de unidad</label>
          <input type="text" name="driver_number" class="form-control mb-3" required>

          <label>Notas</label>
          <textarea name="approval_notes" class="form-control"></textarea>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-success">Aprobar</button>
        </div>
      </form>

    </div>
  </div>
</div>


<!-- RECHAZAR -->
<div class="modal fade" id="rejectModal{{ driver.pk }}" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header bg-danger">
        <h5 class="modal-title">Rechazar {{ driver.get_full_name }}</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="post" action="{% url 'dashboard_driver_reject' driver.pk %}">
        {% csrf_token %}
        <div class="modal-body">
          <label>Razón</label>
          <textarea name="reason" class="form-control" required></textarea>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-danger">Rechazar</button>
        </div>
      </form>

    </div>
  </div>
</div>

{% endfor %}

</div>
{% endblock %}



